metadata:
  id: CKV3_SAST_25
  name: 'Ensure creating temp file done with secure permissions'
  category: 'sast'
  cwe: 'CWE-378: Creation of Temporary File With Insecure Permissions'
scope:
  languages:
    - javascript
definition:
  - or:
    - cond_type: "pattern"
      operator: "equals"
      value: |
        $FS = require('fs');
        ...
        $FS.$FUNCTION($FILE_PATH,$OPTIONS,...)
    - cond_type: "pattern"
      operator: "equals"
      value: |
        $FS = require('fs');
        ...
        mode = $OPTIONS
        ...
        $FS.$FUNCTION($FILE_PATH,...,{mode})
    - cond_type: "pattern"
      operator: "equals"
      value: |
        $FS = require('fs');
        ...
        mode = $OPTIONS
        ...
        $FS.$FUNCTION($FILE_PATH,...,mode)
  - cond_type: variable
    variable: $OPTIONS
    operator: pattern_match
    value:
      - and:
        - cond_type: pattern
          operator: not_equals
          value: >
            {secureOptions: $CONST.S_IXUSR | $CONST.S_IXGRP | $CONST.S_IXOTH}
  - cond_type: variable
    variable: $FILE_PATH
    operator: regex_match
    value: "(?i)(.*temp.*)"
  - cond_type: variable
    variable: $FUNCTION
    operator: regex_match
    value: (writeFileSync|writeFile|open)